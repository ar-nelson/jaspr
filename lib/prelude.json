{
  "par": [null, { "⚙scope": {}, "fn": null }],
  "array": [null, { "⚙scope": {}, "fn": "⚙args" }],
  "object": [null, { "⚙scope": {}, "fn": ["⚙makeObject", "⚙args"] }],

  "let": ["⚙objectMerge", ["⚙extendScope"], [null, {
    "macro": [true, [["⚙objectMerge",
      ["⚙extendScope", [false, [0, "⚙args"]]],
      {"fn": [[false, null], [false, [1, "⚙args"]]]}]]]
  }]],
  "varargs-macro": ["⚙objectMerge", ["⚙extendScope"], [null, {
    "macro": [true, ["⚙objectMerge", ["⚙extendScope"], [
      [false, null],
      {"macro": ["let", {"args": "⚙args"}, [false, [0, "⚙args"]]]}]]]
  }]],
  "varargs-fn": ["varargs-macro",
    [true, ["⚙objectMerge", ["⚙extendScope"], [
      [false, null],
      {"fn": ["let", {"args": "⚙args"}, [false, [0, "args"]]]}]]]],
  "fn1": ["varargs-macro",
    [true, ["⚙objectMerge", ["⚙extendScope"], [
      [false, null],
      {"fn": ["let", ["object", ["array", [[false, null], [false, [0, "args"]]],
                                          [0, "⚙args"]]],
                     [false, [1, "args"]]]}]]]],
  "fn2": ["varargs-macro",
    [true, ["⚙objectMerge", ["⚙extendScope"], [
      [false, null],
      {"fn": ["let", ["object", ["array", [[false, null], [false, [0, "args"]]],
                                          [0, "⚙args"]],
                                ["array", [[false, null], [false, [1, "args"]]],
                                          [1, "⚙args"]]],
                     [false, [2, "args"]]]}]]]],
  "λ": {"⚙alias": [null, "fn1"]},
  "\\": {"⚙alias": [null, "fn1"]},

  "is?": ["fn2", "a", "b", ["⚙equals", "a", "b"]],
  "null?": ["fn1", "a", ["is?", "a", null]],
  "boolean?": ["fn1", "a", ["⚙isBoolean", "a"]],
  "number?": ["fn1", "a", ["⚙isNumber", "a"]],
  "string?": ["fn1", "a", ["⚙isString", "a"]],
  "array?": ["fn1", "a", ["⚙isArray", "a"]],
  "object?": ["fn1", "a", ["⚙isObject", "a"]],
  "no": ["fn1", "a", ["⚙if", "a", false, true]],
  "isnt?": ["fn2", "a", "b", ["no", ["is?", "a", "b"]]],
  "to-string": ["partial", "⚙toString"],
  "to-json": ["partial", "⚙toJson"],
  "from-json": ["partial", "⚙fromJson"],
  "print": ["partial", "⚙print"],
  "eval": ["varargs-macro", 
    [true, [["⚙objectMerge", ["⚙extendScope"], {"fn": [false, [0, "args"]]}]]]],
  "partial": ["varargs-macro",
    [true, ["varargs-fn", ["eval", [[false, true], [
        [false, ["hd", "args"]],
        [[false], ["map", ["fn1", "x", ["array", null, ["eval", "x"]]], ["tl", "args"]]],
        [[false, [null, [false]]],
           ["map", ["fn1", "x", ["array", null, "x"]], "args"]]]]]]]],

  "length": ["fn1", "a", ["⚙arrayLength", "a"]],
  "slice": ["varargs-fn",
    ["⚙arraySlice", [2, "args"], [0, "args"], [1, "args"]]],
  "take": ["fn2", "n", "xs", ["slice", 0, "n", "xs"]],
  "drop": ["fn2", "n", "xs", ["slice", "n", ["length", "xs"], "xs"]],
  "concat": ["varargs-fn",
    ["reduce", ["fn2", "a", "b", [true, [[[false], "a"], [[false], "b"]]]],
               [], "args"]],
  "hd": 0,
  "tl": ["fn1", "xs", ["drop", 1, "xs"]],
  "last": -1,
  "init": ["fn1", "xs", ["take", ["-", ["length", "xs"], 1], "xs"]],
  "cons": ["fn2", "h", "t", [true, [[false, "h"], [[false], "t"]]]],
  "snoc": ["fn2", "i", "l", [true, [[[false], "i"], [false, "l"]]]],
  "zip": ["fn2", "xs", "ys",
    ["if", ["no", "xs"], [],
           ["no", "ys"], [],
           ["cons", ["array", ["hd", "xs"], ["hd", "ys"]],
                    ["zip", ["tl", "xs"], ["tl", "ys"]]]]],
  "for": ["fn2", "f", "xs",
    ["if", "xs", ["par", ["f", ["hd", "xs"]],
                         ["for", "f", ["tl", "xs"]]],
                 null]],
  "map": ["fn2", "f", "xs",
    ["if", "xs", ["cons", ["f", ["hd", "xs"]],
                          ["map", "f", ["tl", "xs"]]],
                 []]],
  "filter": ["fn2", "f", "xs",
    ["if", ["no", "xs"],        [],
           ["f", ["hd", "xs"]], ["cons", ["hd", "xs"],
                                         ["filter", "f", ["tl", "xs"]]],
                                ["filter", "f", ["tl", "xs"]]]],
  "fold-right": ["varargs-fn",
    ["let", {
      "f": [0, "args"],
      "init": [1, "args"],
      "xs": [2, "args"]
    }, ["if", "xs",
          ["f", ["hd", "xs"], ["fold-right", "f", "init", ["tl", "xs"]]],
          "init"]]],
  "fold-left": ["varargs-fn",
    ["let", {
      "f": [0, "args"],
      "init": [1, "args"],
      "xs": [2, "args"]
    }, ["if", "xs",
          ["fold-left", "f", ["f", "init", ["hd", "xs"]], ["tl", "xs"]],
          "init"]]],
  "fold": {"⚙alias": [null, "fold-left"]},
  "reduce": {"⚙alias": [null, "fold-left"]},
  "flatten": ["fn1", "xs",
    ["if", "xs", ["concat", ["hd", "xs"], ["flatten", ["tl", "xs"]]], []]],
  "flat-map": ["fn2", "f", "xs", ["flatten", ["map", "f", "xs"]]],

  "if": ["varargs-macro",
    [true, ["⚙if", [false, [0, "args"]], [false, [1, "args"]],
      [false, ["⚙if", ["is?", ["length", "args"], 3],
                      [2, "args"],
                      ["cons", [null, "⚙if"], ["slice", "args", 2]]]]]]],
  "and": ["varargs-macro",
    ["if", "args",
      [true, ["if", [false, ["hd", "args"]],
                    ["and", [[false], ["tl", "args"]]],
                    false]],
      true]],
  "or": ["varargs-macro",
    ["if", "args",
      [true, ["if", [false, ["hd", "args"]],
                    true,
                    ["or", [[false], ["tl", "args"]]]]],
      false]],

  "+": ["varargs-fn", ["reduce", ["partial", "⚙add"], 0, "args"]],
  "*": ["varargs-fn", ["reduce", ["partial", "⚙multiply"], 1, "args"]],
  "-": ["varargs-fn",
    ["if", ["is?", 1, ["length", "args"]],
           ["⚙negate", [0, "args"]],
           ["reduce", ["partial", "⚙subtract"], ["hd", "args"], ["tl", "args"]]]],
  "div": ["partial", "⚙divide"],
  "mod": ["partial", "⚙modulus"],

  "str": ["varargs-fn",
    ["reduce", ["partial", "⚙stringJoin"], [null, ""], "args"]],
  "strlen": ["partial", "⚙stringLength"],
  "substr": ["varargs-fn",
    ["⚙stringSlice", [0, "args"], [1, "args"],
      ["⚙if", ["is?", 2, ["length", "args"]],
              ["strlen", [0, "args"]],
              [2, "args"]]]],

  "merge": ["varargs-fn",
    ["reduce", ["partial", "⚙objectMerge"], {}, "args"]],
  "assoc": ["varargs-fn",
    ["merge", [0, "args"], ["object", ["array", [1, "args"], [2, "args"]]]]],
  "dissoc": ["fn2", "o", "k", ["⚙objectDelete", "o", "k"]],
  "update":  ["varargs-fn",
    ["let", {"o": [0, "args"], "k": [1, "args"]},
      ["merge", "o", ["object", ["array", "k", [[2, "args"], ["k", "o"]]]]]]],
  "keys": ["partial", "⚙objectKeys", "x"],
  "values": ["fn1", "x",
    ["map", ["fn1", "k", ["k", "x"]], ["keys", "x"]]],
  "entries": ["fn1", "x",
    ["map", ["fn1", "k", ["array", "k", ["k", "x"]]], ["keys", "x"]]]
}
